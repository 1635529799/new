 {% extends 'base.html' %}
{% load static %}
{% block content %}
    <main class="lyear-layout-content">

        <div class="container-fluid">
            <div class="row">

                <div class="col-md-12">
                        <div>
                    <div class="card">
                        <div class="card-header"><h4 ><a href="http://localhost:7474/browser/"  target="_blank">查看图谱数据库</a></h4></div>
                        <div class="card-body">
                            <div>
                            <form action="/" id="rec" method="get">

                                <form action="/" method="get" id = 'searchEntityForm'>
                                {% csrf_token %}
                                <div class="input-group">

                                    <input type="text" id = "key" value="{{ inputs }}" name = "key" class="form-control" placeholder="节点名称" aria-describedby="basic-addon1">
                                    <span class="btn btn-primary input-group-addon" type="button" id="relationSearchButton" style="background-color:#4592fe ; padding:6px 38px" onclick="document.forms[0].action='/';document.forms[0].submit();">查询</span>
                                    <span  class="btn btn-primary input-group-addon" type="button" id="relationSearchButton" style="background-color:#2ecc71 ; padding:6px 38px" onclick="document.forms[0].action='/rec';document.forms[0].submit();">在线推荐</span>

                                </div>

                            </form>

                            </form>

                        </div>
{#                        <div class="card-body">#}
                            <div class="top_card">
                            {% if ss %}
                                <h3 style="color: blue">{{ ss | safe }}</h3>
                                {#                                    <p>注意：绿色为识别的到的节点和关系，红色为neo4j查询的最后结果！</p>#}
                            {% endif %}
                    </div>


                </div>

                <div class="col-md-12">
                    <div class="card">
                        <div class="card-body">

                            <div id="main" style="width: 100%;height: 640px"></div>

                        </div>
                    </div>


                </div>
            </div>


        </div>

    </main>
    <script src="/static/jquery-1.10.2.min.js"></script>
    <script src="/static/echarts.min.js"></script>
    <script type="text/javascript">
        var myChart = echarts.init(document.getElementById('main'));
        option1 = {
            // backgroundColor: "white",
            title: {
                text: '',
                textStyle: {
                    // color: "white",
                    fontWeight: "lighter",
                }
            },
            animationDurationUpdate: 1500,
            animationEasingUpdate: 'quinticInOut',
            legend: {
                x: "center",
                show: true,
                data: {{ legend_data | safe }}
            },
            series: [
                {
                    type: 'graph',
                    layout: 'force',
                    symbolSize: 50,
                    edgeSymbol: ['circle', 'arrow'],
                    edgeSymbolSize: [4, 4],
                    edgeLabel: {
                        normal: {
                            show: true,
                            formatter: function (x) {
                                return x.data.name;
                            },
                            textStyle: {
                                fontSize: 10
                            },
                        }
                    },
                    force: {
                        repulsion: 2500,
                        edgeLength: [10, 100]
                    },
                    focusNodeAdjacency: true,
                    draggable: true,
                    roam: true,
                    categories: {{ categories | safe }},
                    label: {
                        normal: {
                            show: true,
                            textStyle: {
                                fontSize: 10
                            },
                        }
                    },
                    force: {
                        repulsion: 1000
                    },
                    tooltip: {
                        formatter: function (node) { // 区分连线和节点，节点上额外显示其他数字
                            if (!node.value) {
                                return node.data.name;
                            } else {
                                return node.data.name + ":" + node.data.showNum;
                            }
                        },
                    },
                    lineStyle: {
                        normal: {
                            opacity: 0.9,
                            width: 1,
                            curveness: 0.3
                        }
                    },
                    // progressiveThreshold: 700,
                    nodes: {{ datas | safe }},
                    links: {{ links | safe }},

                }
            ]
        };
        myChart.setOption(option1);
    </script>
{% endblock %}
