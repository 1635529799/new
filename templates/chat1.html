{% extends 'base.html' %}
{% load static %}
{% block content %}
    <main class="lyear-layout-content">

        <div class="container-fluid">

            <div class="row">


                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header"><h4>请输入问题</h4></div>
                        <div class="card-body">

                            <form action="/chat" method="get">
                                {% csrf_token %}
                                <div class="form-group">
{#                                    <label for="example-nf-email">推荐问题：#}
{#                                    {% for rec in recommends %}#}
{#                                        {{ rec }}#}
{#                                {% endfor %}#}
{#                                    。#}
{#                                    </label>#}
{#                                    <input class="form-control" type="text" name="key" placeholder="请输入问题"#}
{#                                           value="{{ key }}">#}

                                    <textarea class="form-control" rows="4" name="key" placeholder="请输入问题">{{  key }}</textarea>

                                </div>

                                <div class="form-group">
                                    <button class="btn btn-primary" type="submit">查找答案</button>
                                </div>
                            </form>

                        </div>
                    </div>
{#                    <div class="col-md-12">#}
{#                    <div class="card">#}
{#                       #}
{#                    </div>#}
{##}
{##}
{#                </div>#}
                    <div class="card">
                        <div class="card-header"><h4>查询到结果</h4></div>
                        <div class="card-body">

                            {% if daan %}
                                <h3 style="color: red">答案：{{ daan | safe }}</h3>
                                {#                                    <p>注意：绿色为识别的到的节点和关系，红色为neo4j查询的最后结果！</p>#}
                            {% endif %}
                            {% if sen %}
                                <hr>
                                <h3>实体识别结果：{{ sen }}</h3>

                            {% endif %}
                            {% if text %}
                                <hr>
                                <h3>原文溯源：{{ text }}</h3>

                            {% endif %}


                        </div>
                       {% if legend_data %}
                                  <h3 style="padding-left: 20px;">关系图谱：</h3>
{#                        <div class="card-body">#}

                                  <div id="main" style="width: 100%;height: 300px"></div>
                       {% endif %}


{##}
{#                        </div>#}
                    </div>

                </div>

                <div class="col-lg-12">
                    <div class="card">
                        <div class="card-header"><h4>知识图谱问答小助手--<a href="/chat?clean=1">点击清除历史记录</a></h4></div>
                        <div class="card-body">

                            <div class="row">
                                <!--单按钮下拉菜单-->
                                {% for wen in all_wendas %}
                                    <div class="col-lg-12">
                                        <h5>{{ wen.question }}</h5>
                                        {{ wen.anster }}
                                        <hr>
                                    </div>
                                {% endfor %}
                            </div>

                        </div>
                    </div>
                </div>


            </div>

        </div>

    </main>
     <script src="/static/jquery-1.10.2.min.js"></script>
    <script src="/static/echarts.min.js"></script>
    <script type="text/javascript">
        var myChart = echarts.init(document.getElementById('main'));
        option1 = {
            // backgroundColor: "white",
            title: {
                text: '',
                textStyle: {
                    // color: "white",
                    fontWeight: "lighter",
                }
            },
            animationDurationUpdate: 1500,
            animationEasingUpdate: 'quinticInOut',
            legend: {
                x: "center",
                show: true,
                data: {{ legend_data | safe }}
            },
            series: [
                {
                    type: 'graph',
                    layout: 'force',
                    symbolSize: 50,
                    edgeSymbol: ['circle', 'arrow'],
                    edgeSymbolSize: [4, 4],
                    edgeLabel: {
                        normal: {
                            show: true,
                            formatter: function (x) {
                                return x.data.name;
                            },
                            textStyle: {
                                fontSize: 10
                            },
                        }
                    },
                    force: {
                        repulsion: 2500,
                        edgeLength: [10, 100]
                    },
                    focusNodeAdjacency: true,
                    draggable: true,
                    roam: true,
                    categories: {{ categories | safe }},
                    label: {
                        normal: {
                            show: true,
                            textStyle: {
                                fontSize: 10
                            },
                        }
                    },
                    force: {
                        repulsion: 1000
                    },
                    tooltip: {
                        formatter: function (node) { // 区分连线和节点，节点上额外显示其他数字
                            if (!node.value) {
                                return node.data.name;
                            } else {
                                return node.data.name + ":" + node.data.showNum;
                            }
                        },
                    },
                    lineStyle: {
                        normal: {
                            opacity: 0.9,
                            width: 1,
                            curveness: 0.3
                        }
                    },
                    // progressiveThreshold: 700,
                    nodes: {{ datas | safe }},
                    links: {{ links | safe }},

                }
            ]
        };
        myChart.setOption(option1);
    </script>
{% endblock %}
